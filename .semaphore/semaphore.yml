version: v1.0
name: Download and cache custom file
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804


blocks:
  - name: Download and Cache
    task:
      jobs:
        - name: Download and Cache .deb
          commands:
            - checkout
            - mkdir debs
            - wget http://ge.archive.ubuntu.com/ubuntu/pool/universe/e/enscript/enscript_1.6.5.90-3_amd64.deb -O ./debs/enscript.deb
            - cache store $SEMAPHORE_WORKFLOW_ID debs

  - name: Reuse from cache
    task:
      prologue:
        commands:
          - checkout
          - cache restore $SEMAPHORE_WORKFLOW_ID
          - sudo dpkg -i ./debs/enscript.deb

      jobs:
        - name: ps -ax output
          commands:
            - ps -ax > psList
            - enscript -pPSlist.ps psList
            - ls -l
        - name: two-column ps -ax
          commands:
            - ps -ax > psList
            - enscript -2rG -pPSlist.ps psList
            - ls -l

